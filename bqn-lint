#!/usr/bin/env bqn

âŸ¨Green, Yellow, RedâŸ© â‡ â€¢Import "../bqn-color/color.bqn"
s  â‡ â€¢Import "../bqn-code/lib/string.bqn"
fs â‡ â€¢Import "../bqn-code/lib/file_system.bqn"
fn â‡ â€¢Import "../bqn-code/lib/fun.bqn"

nl â† @+10

title â† {
    d â† "__â†‘" 
    nlâˆ¾(Red d)âˆ¾Green " bqn-lint "âˆ¾(Red âŒ½d)âˆ¾nl
}

replacements â† âŸ¨âŸ¨"0â‰ â‰ ", "Ã—â‰ "âŸ©âŸ© # TODO add more

CheckReplacement â† { fâ€¿(tâ€¿r)ğ•Šlâ€¿i: 
    m â† tâ·l
    { Â¬âˆ¨Â´m ? "" ; 
        â€¢Out "In "âˆ¾fâˆ¾":"
        â€¢Out "  Line "âˆ¾(â€¢Fmt i)âˆ¾":"
        â€¢Out "    "âˆ¾(Red t) s.Join t s.Split l
        â€¢Out "    "âˆ¾ Yellow " â†‘"âŠËœt fn.FindFull l
        n â† âŠ‘/tâ·l
        â€¢Out "    "âˆ¾(n/" ")âˆ¾(Yellow "this can be: ")âˆ¾Green r
        â€¢Out âŸ¨âŸ©
    }
}

LintSingleFile â† { ğ•Šfile:
    l â† â€¢file.Lines ğ•©
    {(fileâ‹ˆğ•©)âŠ¸CheckReplacementÂ¨(â‹ˆÂ¨âŸœ(â†•âˆ˜â‰ )l)}Â¨replacements
}

main â† {
    â€¢Out title
    (Red "Must provide directory (`pwd` for current)") ! 0â‰ â‰ â€¢args
    d â† 0âŠ‘â€¢args  # directory
    f â† fs.ListRecursiveBQNFiles d
    LintSingleFileÂ¨f
}

main