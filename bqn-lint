#!/usr/bin/env bqn

c  â‡ â€¢Import "../bqn-color/color.bqn"
s  â‡ â€¢Import "../bqn-code/lib/string.bqn"
fs â‡ â€¢Import "../bqn-code/lib/file_system.bqn"
fn â‡ â€¢Import "../bqn-code/lib/fun.bqn"

nl     â† @+10
colors â† c.Greenâ€¿c.Yellowâ€¿c.Red

title â† {
    a â† "â†‘â†‘â†‘" # arrows
    nlâˆ¾(âˆ¾colors{ğ•ğ•©}Â¨a)âˆ¾c.Green " bqn-test "âˆ¾(âˆ¾colors{ğ•ğ•©}Â¨â—‹âŒ½a)âˆ¾nl
}

replacements â† âŸ¨âŸ¨"0â‰ â‰ ", "Ã—â‰ "âŸ©âŸ© # TODO add more

CheckReplacement â† { fâ€¿(tâ€¿r)ğ•Šiâ€¿l:
    m â† tâ·l
    { Â¬âˆ¨Â´m ? "" ; 
        â€¢Out "In "âˆ¾fâˆ¾":"
        â€¢Out "  Line "âˆ¾(â€¢Fmt i)âˆ¾":"
        â€¢Out "    "âˆ¾(c.Red t) s.Join t s.Split l
        â€¢Out "    "âˆ¾ c.Yellow " â†‘"âŠËœt fn.FindFull l
        â€¢Out "    "âˆ¾(" "/ËœâŠ‘/m)âˆ¾(c.Yellow "this can be: ")âˆ¾c.Green r
        â€¢Out âŸ¨âŸ©
    }
}

LintSingleFile â† { ğ•Šfile:
    l â† â€¢file.Lines ğ•©
    {(fileâ‹ˆğ•©)âŠ¸CheckReplacementÂ¨(â†•âˆ˜â‰ âŠ¸(â‹ˆÂ¨)l)}Â¨replacements
}

main â† {
    â€¢Out title
    (c.Red "Must provide directory (`pwd` for current)") ! 0â‰ â‰ â€¢args
    d â† 0âŠ‘â€¢args  # directory
    f â† fs.ListRecursiveBQNFiles d
    LintSingleFileÂ¨f
}

main